
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>apply: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">github.com/naoto24kawa/mcpconfig/cmd/apply/apply.go (0.0%)</option>
				
				<option value="file1">github.com/naoto24kawa/mcpconfig/cmd/create/create.go (0.0%)</option>
				
				<option value="file2">github.com/naoto24kawa/mcpconfig/cmd/delete/delete.go (0.0%)</option>
				
				<option value="file3">github.com/naoto24kawa/mcpconfig/cmd/list/list.go (0.0%)</option>
				
				<option value="file4">github.com/naoto24kawa/mcpconfig/cmd/profile/profile.go (64.7%)</option>
				
				<option value="file5">github.com/naoto24kawa/mcpconfig/cmd/rename/rename.go (0.0%)</option>
				
				<option value="file6">github.com/naoto24kawa/mcpconfig/cmd/reset/reset.go (0.0%)</option>
				
				<option value="file7">github.com/naoto24kawa/mcpconfig/cmd/root.go (0.0%)</option>
				
				<option value="file8">github.com/naoto24kawa/mcpconfig/cmd/save/save.go (0.0%)</option>
				
				<option value="file9">github.com/naoto24kawa/mcpconfig/cmd/server/add/add.go (0.0%)</option>
				
				<option value="file10">github.com/naoto24kawa/mcpconfig/cmd/server/delete/delete.go (0.0%)</option>
				
				<option value="file11">github.com/naoto24kawa/mcpconfig/cmd/server/list/list.go (0.0%)</option>
				
				<option value="file12">github.com/naoto24kawa/mcpconfig/cmd/server/remove/remove.go (0.0%)</option>
				
				<option value="file13">github.com/naoto24kawa/mcpconfig/cmd/server/rename/rename.go (0.0%)</option>
				
				<option value="file14">github.com/naoto24kawa/mcpconfig/cmd/server/save/save.go (0.0%)</option>
				
				<option value="file15">github.com/naoto24kawa/mcpconfig/cmd/server/server.go (0.0%)</option>
				
				<option value="file16">github.com/naoto24kawa/mcpconfig/cmd/server/show/show.go (0.0%)</option>
				
				<option value="file17">github.com/naoto24kawa/mcpconfig/internal/config/config.go (44.4%)</option>
				
				<option value="file18">github.com/naoto24kawa/mcpconfig/internal/errors/errors.go (100.0%)</option>
				
				<option value="file19">github.com/naoto24kawa/mcpconfig/internal/interaction/interaction.go (71.4%)</option>
				
				<option value="file20">github.com/naoto24kawa/mcpconfig/internal/mcpconfig/mcpconfig.go (0.0%)</option>
				
				<option value="file21">github.com/naoto24kawa/mcpconfig/internal/profile/profile.go (81.5%)</option>
				
				<option value="file22">github.com/naoto24kawa/mcpconfig/internal/server/helpers.go (100.0%)</option>
				
				<option value="file23">github.com/naoto24kawa/mcpconfig/internal/server/server.go (16.3%)</option>
				
				<option value="file24">github.com/naoto24kawa/mcpconfig/internal/server/template_display.go (100.0%)</option>
				
				<option value="file25">github.com/naoto24kawa/mcpconfig/internal/server/template_manager.go (78.4%)</option>
				
				<option value="file26">github.com/naoto24kawa/mcpconfig/internal/server/template_updater.go (91.3%)</option>
				
				<option value="file27">github.com/naoto24kawa/mcpconfig/internal/utils/errors.go (0.0%)</option>
				
				<option value="file28">github.com/naoto24kawa/mcpconfig/internal/utils/file.go (94.6%)</option>
				
				<option value="file29">github.com/naoto24kawa/mcpconfig/internal/utils/validation.go (100.0%)</option>
				
				<option value="file30">github.com/naoto24kawa/mcpconfig/main.go (0.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package apply

import (
        "fmt"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/cmd/profile"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(args []string) <span class="cov0" title="0">{
        profileName, argsOffset := utils.ParseProfileName(args, config.DefaultProfileName)
        var targetPath string

        for i := argsOffset; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--to", "-t":<span class="cov0" title="0">
                        var err error
                        targetPath, i, err = utils.ParseFlag(args, i, "--to")
                        utils.HandleArgumentError(err)</span>
                }
        }

        <span class="cov0" title="0">if targetPath == "" </span><span class="cov0" title="0">{
                targetPath = config.GetDefaultMCPConfigPath()
                fmt.Printf("適用先が指定されていないため、デフォルトパスを使用します: %s\n", targetPath)
        }</span>

        <span class="cov0" title="0">utils.HandleArgumentError(utils.ValidateName(profileName, "プロファイル"))

        cfg, err := config.New()
        utils.HandleEnvironmentError(err)

        utils.HandleGeneralError(profile.Apply(cfg, profileName, targetPath))</span>
}</pre>
		
		<pre class="file" id="file1" style="display: none">package create

import (
        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/cmd/profile"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(args []string) <span class="cov0" title="0">{
        profileName, argsOffset := utils.ParseProfileName(args, config.DefaultProfileName)
        var templateName string

        for i := argsOffset; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--template", "-t":<span class="cov0" title="0">
                        var err error
                        templateName, i, err = utils.ParseFlag(args, i, "--template")
                        utils.HandleArgumentError(err)</span>
                }
        }

        <span class="cov0" title="0">utils.HandleArgumentError(utils.ValidateName(profileName, "プロファイル"))

        cfg, err := config.New()
        utils.HandleEnvironmentError(err)

        utils.HandleGeneralError(profile.Create(cfg, profileName, templateName))</span>
}</pre>
		
		<pre class="file" id="file2" style="display: none">package delete

import (
        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/cmd/profile"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(args []string) <span class="cov0" title="0">{
        profileName, argsOffset := utils.ParseProfileName(args, config.DefaultProfileName)
        force := false

        for i := argsOffset; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--force", "-f":<span class="cov0" title="0">
                        force = true</span>
                }
        }

        <span class="cov0" title="0">utils.HandleArgumentError(utils.ValidateName(profileName, "プロファイル"))

        cfg, err := config.New()
        utils.HandleEnvironmentError(err)

        utils.HandleGeneralError(profile.Delete(cfg, profileName, force))</span>
}</pre>
		
		<pre class="file" id="file3" style="display: none">package list

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/cmd/profile"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(args []string) <span class="cov0" title="0">{
        detail := false

        for _, arg := range args </span><span class="cov0" title="0">{
                switch arg </span>{
                case "--detail", "-d":<span class="cov0" title="0">
                        detail = true</span>
                }
        }

        <span class="cov0" title="0">cfg, err := config.New()
        if err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitEnvironment)
        }</span>

        <span class="cov0" title="0">if err := profile.List(cfg, detail); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitGeneralError)
        }</span>
}</pre>
		
		<pre class="file" id="file4" style="display: none">package profile

import (
        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/profile"
        "github.com/naoto24kawa/mcpconfig/internal/server"
)

func Apply(cfg *config.Config, profileName, targetPath string) error <span class="cov0" title="0">{
        profileManager := profile.NewManager(cfg.ProfilesDir)
        serverManager := server.NewManager(cfg.ServersDir)
        
        return profileManager.Apply(profileName, targetPath, serverManager)
}</span>

func Save(cfg *config.Config, profileName, fromPath string, force bool) error <span class="cov0" title="0">{
        profileManager := profile.NewManager(cfg.ProfilesDir)
        serverManager := server.NewManager(cfg.ServersDir)
        
        return profileManager.Save(profileName, fromPath, serverManager, force)
}</span>

func Create(cfg *config.Config, profileName, templateName string) error <span class="cov8" title="1">{
        profileManager := profile.NewManager(cfg.ProfilesDir)
        
        description := ""
        if templateName != "" </span><span class="cov8" title="1">{
                description = "テンプレート " + templateName + " から作成"
        }</span>
        
        <span class="cov8" title="1">return profileManager.Create(profileName, description)</span>
}

func List(cfg *config.Config, detail bool) error <span class="cov8" title="1">{
        profileManager := profile.NewManager(cfg.ProfilesDir)
        return profileManager.List(detail)
}</span>

func Delete(cfg *config.Config, profileName string, force bool) error <span class="cov8" title="1">{
        profileManager := profile.NewManager(cfg.ProfilesDir)
        return profileManager.Delete(profileName, force)
}</span>

func Rename(cfg *config.Config, oldName, newName string, force bool) error <span class="cov8" title="1">{
        profileManager := profile.NewManager(cfg.ProfilesDir)
        return profileManager.Rename(oldName, newName, force)
}</pre>
		
		<pre class="file" id="file5" style="display: none">package rename

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/cmd/profile"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(args []string) <span class="cov0" title="0">{
        oldName, newName, argsOffset, err := utils.ParseRenameArgs(args, config.DefaultProfileName)
        if err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitArgumentError)
        }</span>
        <span class="cov0" title="0">force := false

        for i := argsOffset; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--force", "-f":<span class="cov0" title="0">
                        force = true</span>
                }
        }

        <span class="cov0" title="0">utils.HandleArgumentError(utils.ValidateName(oldName, "プロファイル"))

        utils.HandleArgumentError(utils.ValidateName(newName, "プロファイル"))

        cfg, err := config.New()
        utils.HandleEnvironmentError(err)

        utils.HandleGeneralError(profile.Rename(cfg, oldName, newName, force))</span>
}</pre>
		
		<pre class="file" id="file6" style="display: none">package reset

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/interaction"
        "github.com/naoto24kawa/mcpconfig/internal/profile"
        "github.com/naoto24kawa/mcpconfig/internal/server"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(cfg *config.Config, args []string) <span class="cov0" title="0">{
        if len(args) == 0 </span><span class="cov0" title="0">{
                PrintUsage()
                os.Exit(0)
        }</span>

        <span class="cov0" title="0">cmd := args[0]
        cmdArgs := args[1:]

        var force bool
        for i, arg := range cmdArgs </span><span class="cov0" title="0">{
                if arg == "--force" || arg == "-f" </span><span class="cov0" title="0">{
                        force = true
                        cmdArgs = append(cmdArgs[:i], cmdArgs[i+1:]...)
                        break</span>
                }
        }

        <span class="cov0" title="0">switch cmd </span>{
        case "all":<span class="cov0" title="0">
                if err := resetAll(force); err != nil </span><span class="cov0" title="0">{
                        fmt.Fprintln(os.Stderr, "エラー:", err)
                        os.Exit(utils.ExitGeneralError)
                }</span>
        case "profiles":<span class="cov0" title="0">
                if err := resetProfiles(force); err != nil </span><span class="cov0" title="0">{
                        fmt.Fprintln(os.Stderr, "エラー:", err)
                        os.Exit(utils.ExitGeneralError)
                }</span>
        case "servers":<span class="cov0" title="0">
                if err := resetServers(force); err != nil </span><span class="cov0" title="0">{
                        fmt.Fprintln(os.Stderr, "エラー:", err)
                        os.Exit(utils.ExitGeneralError)
                }</span>
        default:<span class="cov0" title="0">
                fmt.Fprintf(os.Stderr, "エラー: 不明なリセットコマンド '%s'\n", cmd)
                PrintUsage()
                os.Exit(utils.ExitGeneralError)</span>
        }
}

func PrintUsage() <span class="cov0" title="0">{
        fmt.Println(`mcpconfig reset - 開発用設定のリセット

使用方法:
  mcpconfig reset &lt;サブコマンド&gt; [オプション]

サブコマンド:
  all       すべての設定をリセット (プロファイル + サーバーテンプレート)
  profiles  すべてのプロファイルを削除
  servers   すべてのサーバーテンプレートを削除

オプション:
  --force, -f  確認なしで実行

例:
  mcpconfig reset all                すべての設定をリセット
  mcpconfig reset profiles --force   確認なしですべてのプロファイルを削除
  mcpconfig reset servers            すべてのサーバーテンプレートを削除`)
}</span>


func resetAll(force bool) error <span class="cov0" title="0">{
        cfg, err := config.New()
        if err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("設定の初期化に失敗しました: %w", err)
        }</span>
        
        <span class="cov0" title="0">if !force </span><span class="cov0" title="0">{
                fmt.Println("以下の設定がすべて削除されます:")
                fmt.Println("  - すべてのプロファイル")
                fmt.Println("  - すべてのサーバーテンプレート")
                fmt.Println()
                
                if !interaction.Confirm("本当にすべての設定をリセットしますか？") </span><span class="cov0" title="0">{
                        fmt.Println("リセットをキャンセルしました")
                        return nil
                }</span>
        }

        <span class="cov0" title="0">if err := resetProfilesWithConfig(cfg, true); err != nil </span><span class="cov0" title="0">{
                fmt.Printf("プロファイルのリセットに失敗しました: %v\n", err)
        }</span>

        <span class="cov0" title="0">if err := resetServersWithConfig(cfg, true); err != nil </span><span class="cov0" title="0">{
                fmt.Printf("サーバーテンプレートのリセットに失敗しました: %v\n", err)
        }</span>

        <span class="cov0" title="0">fmt.Println("すべての設定をリセットしました")
        return nil</span>
}

func resetProfiles(force bool) error <span class="cov0" title="0">{
        cfg, err := config.New()
        if err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("設定の初期化に失敗しました: %w", err)
        }</span>
        
        <span class="cov0" title="0">return resetProfilesWithConfig(cfg, force)</span>
}

func resetServers(force bool) error <span class="cov0" title="0">{
        cfg, err := config.New()
        if err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("設定の初期化に失敗しました: %w", err)
        }</span>
        
        <span class="cov0" title="0">return resetServersWithConfig(cfg, force)</span>
}

func resetProfilesWithConfig(cfg *config.Config, force bool) error <span class="cov0" title="0">{
        profileManager := profile.NewManager(cfg.ProfilesDir)
        return profileManager.Reset(force)
}</span>

func resetServersWithConfig(cfg *config.Config, force bool) error <span class="cov0" title="0">{
        serverManager := server.NewManager(cfg.ServersDir)
        return serverManager.Reset(force)
}</pre>
		
		<pre class="file" id="file7" style="display: none">package cmd

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/cmd/apply"
        "github.com/naoto24kawa/mcpconfig/cmd/create"
        "github.com/naoto24kawa/mcpconfig/cmd/delete"
        "github.com/naoto24kawa/mcpconfig/cmd/list"
        "github.com/naoto24kawa/mcpconfig/cmd/rename"
        "github.com/naoto24kawa/mcpconfig/cmd/reset"
        "github.com/naoto24kawa/mcpconfig/cmd/save"
        "github.com/naoto24kawa/mcpconfig/cmd/server"
        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

var Version = "dev"

func Execute() <span class="cov0" title="0">{
        if len(os.Args) == 1 </span><span class="cov0" title="0">{
                printUsage()
                os.Exit(0)
        }</span>

        <span class="cov0" title="0">cmd := os.Args[1]
        args := os.Args[2:]

        switch cmd </span>{
        case "help", "-h", "--help":<span class="cov0" title="0">
                printUsage()
                os.Exit(0)</span>
        case "version", "-v", "--version":<span class="cov0" title="0">
                fmt.Printf("mcpconfig version %s\n", Version)
                os.Exit(0)</span>
        case "apply":<span class="cov0" title="0">
                apply.Execute(args)</span>
        case "save":<span class="cov0" title="0">
                save.Execute(args)</span>
        case "create":<span class="cov0" title="0">
                create.Execute(args)</span>
        case "list":<span class="cov0" title="0">
                list.Execute(args)</span>
        case "delete":<span class="cov0" title="0">
                delete.Execute(args)</span>
        case "rename":<span class="cov0" title="0">
                rename.Execute(args)</span>
        case "server":<span class="cov0" title="0">
                handleServer(args)</span>
        case "reset":<span class="cov0" title="0">
                handleReset(args)</span>
        default:<span class="cov0" title="0">
                fmt.Fprintf(os.Stderr, "エラー: 不明なコマンド '%s'\n", cmd)
                printUsage()
                os.Exit(utils.ExitGeneralError)</span>
        }
}

func printUsage() <span class="cov0" title="0">{
        fmt.Printf(`mcpconfig - MCP設定ファイル管理ツール

使用方法:
  mcpconfig &lt;コマンド&gt; [オプション] [引数]

コマンド:
  apply [プロファイル名] --to &lt;パス&gt;         プロファイルを指定パスに適用 (デフォルト: %s)
  save [プロファイル名] --from &lt;パス&gt;        現在の設定をプロファイルとして保存 (デフォルト: %s)
  create [プロファイル名]                    新規プロファイルを作成 (デフォルト: %s)
  list [--detail]                           プロファイル一覧を表示
  delete [プロファイル名]                    プロファイルを削除 (デフォルト: %s)
  rename [現在の名前] &lt;新しい名前&gt;           プロファイル名を変更 (デフォルト: %s)
  server &lt;サブコマンド&gt;                      MCPサーバー管理
  reset &lt;サブコマンド&gt;                       開発用設定のリセット

注意: []で囲まれた引数は省略可能で、省略時はデフォルトプロファイル名 '%s' が使用されます

グローバルオプション:
  --help, -h      ヘルプを表示
  --version, -v   バージョンを表示

詳細は 'mcpconfig help &lt;コマンド&gt;' で確認してください`, 
                config.DefaultProfileName, 
                config.DefaultProfileName, 
                config.DefaultProfileName, 
                config.DefaultProfileName, 
                config.DefaultProfileName, 
                config.DefaultProfileName)
}</span>


func handleServer(args []string) <span class="cov0" title="0">{
        if len(args) == 0 </span><span class="cov0" title="0">{
                server.PrintUsage()
                os.Exit(0)
        }</span>

        <span class="cov0" title="0">cfg, err := config.New()
        if err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitEnvironment)
        }</span>

        <span class="cov0" title="0">server.Execute(cfg, args)</span>
}

func handleReset(args []string) <span class="cov0" title="0">{
        if len(args) == 0 </span><span class="cov0" title="0">{
                reset.PrintUsage()
                os.Exit(0)
        }</span>

        <span class="cov0" title="0">cfg, err := config.New()
        if err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitEnvironment)
        }</span>

        <span class="cov0" title="0">reset.Execute(cfg, args)</span>
}</pre>
		
		<pre class="file" id="file8" style="display: none">package save

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/cmd/profile"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(args []string) <span class="cov0" title="0">{
        profileName, argsOffset := utils.ParseProfileName(args, config.DefaultProfileName)
        var fromPath string
        force := false

        for i := argsOffset; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--from", "-f":<span class="cov0" title="0">
                        var err error
                        fromPath, i, err = utils.ParseFlag(args, i, "--from")
                        utils.HandleArgumentError(err)</span>
                case "--force", "-F":<span class="cov0" title="0">
                        force = true</span>
                }
        }

        <span class="cov0" title="0">if fromPath == "" </span><span class="cov0" title="0">{
                fromPath = config.FindMCPConfigPath()
                if fromPath == "" </span><span class="cov0" title="0">{
                        fmt.Fprintln(os.Stderr, "エラー: MCP設定ファイルが見つかりません")
                        fmt.Fprintln(os.Stderr, "使用方法: mcpconfig save &lt;プロファイル名&gt; --from &lt;パス&gt;")
                        os.Exit(utils.ExitArgumentError)
                }</span>
                <span class="cov0" title="0">fmt.Printf("MCP設定ファイルを自動検出しました: %s\n", fromPath)</span>
        }

        <span class="cov0" title="0">utils.HandleArgumentError(utils.ValidateName(profileName, "プロファイル"))

        cfg, err := config.New()
        utils.HandleEnvironmentError(err)

        utils.HandleGeneralError(profile.Save(cfg, profileName, fromPath, force))</span>
}</pre>
		
		<pre class="file" id="file9" style="display: none">package add

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/profile"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(cfg *config.Config, args []string) <span class="cov0" title="0">{
        if len(args) &lt; 1 </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー: テンプレート名が指定されていません")
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">templateName := args[0]
        var profileName, serverName, envStr string

        for i := 1; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--to", "-t":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --to オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">profileName = args[i+1]
                        i++</span>
                case "--as", "-a":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --as オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">serverName = args[i+1]
                        i++</span>
                case "--env", "-e":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --env オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">envStr = args[i+1]
                        i++</span>
                }
        }

        <span class="cov0" title="0">if profileName == "" </span><span class="cov0" title="0">{
                profileName = config.DefaultProfileName
                fmt.Printf("プロファイル名が指定されていないため、デフォルト '%s' を使用します\n", profileName)
        }</span>

        <span class="cov0" title="0">if err := utils.ValidateName(templateName, "サーバーテンプレート"); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">if err := utils.ValidateName(profileName, "プロファイル"); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">envOverrides := make(map[string]string)
        if envStr != "" </span><span class="cov0" title="0">{
                parsedEnv, err := utils.ParseEnvVars(envStr)
                if err != nil </span><span class="cov0" title="0">{
                        fmt.Fprintln(os.Stderr, "エラー:", err)
                        os.Exit(utils.ExitArgumentError)
                }</span>
                <span class="cov0" title="0">envOverrides = parsedEnv</span>
        }

        <span class="cov0" title="0">profileManager := profile.NewManager(cfg.ProfilesDir)
        if err := profileManager.AddServer(profileName, templateName, serverName, envOverrides); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitGeneralError)
        }</span>
}</pre>
		
		<pre class="file" id="file10" style="display: none">package delete

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/server"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(cfg *config.Config, args []string) <span class="cov0" title="0">{
        if len(args) &lt; 1 </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー: テンプレート名が指定されていません")
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">templateName := args[0]
        force := false

        for i := 1; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--force", "-f":<span class="cov0" title="0">
                        force = true</span>
                }
        }

        <span class="cov0" title="0">if err := utils.ValidateName(templateName, "サーバーテンプレート"); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">serverManager := server.NewManager(cfg.ServersDir)
        if err := serverManager.Delete(templateName, force); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitGeneralError)
        }</span>
}</pre>
		
		<pre class="file" id="file11" style="display: none">package list

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/server"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(cfg *config.Config, args []string) <span class="cov0" title="0">{
        detail := false

        for _, arg := range args </span><span class="cov0" title="0">{
                switch arg </span>{
                case "--detail", "-d":<span class="cov0" title="0">
                        detail = true</span>
                }
        }

        <span class="cov0" title="0">serverManager := server.NewManager(cfg.ServersDir)
        if err := serverManager.List(detail); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitGeneralError)
        }</span>
}</pre>
		
		<pre class="file" id="file12" style="display: none">package remove

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/profile"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(cfg *config.Config, args []string) <span class="cov0" title="0">{
        if len(args) &lt; 1 </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー: サーバー名が指定されていません")
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">serverName := args[0]
        var profileName string

        for i := 1; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--from", "-f":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --from オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">profileName = args[i+1]
                        i++</span>
                }
        }

        <span class="cov0" title="0">if profileName == "" </span><span class="cov0" title="0">{
                profileName = config.DefaultProfileName
                fmt.Printf("プロファイル名が指定されていないため、デフォルト '%s' を使用します\n", profileName)
        }</span>

        <span class="cov0" title="0">if err := utils.ValidateName(profileName, "プロファイル"); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">profileManager := profile.NewManager(cfg.ProfilesDir)
        if err := profileManager.RemoveServer(profileName, serverName); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitGeneralError)
        }</span>
}</pre>
		
		<pre class="file" id="file13" style="display: none">package rename

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/server"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(cfg *config.Config, args []string) <span class="cov0" title="0">{
        if len(args) &lt; 2 </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー: テンプレート名が指定されていません")
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">oldName := args[0]
        newName := args[1]
        force := false

        for i := 2; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--force", "-f":<span class="cov0" title="0">
                        force = true</span>
                }
        }

        <span class="cov0" title="0">if err := utils.ValidateName(oldName, "サーバーテンプレート"); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">if err := utils.ValidateName(newName, "サーバーテンプレート"); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">serverManager := server.NewManager(cfg.ServersDir)
        if err := serverManager.Rename(oldName, newName, force); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitGeneralError)
        }</span>
}</pre>
		
		<pre class="file" id="file14" style="display: none">package save

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/server"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(cfg *config.Config, args []string) <span class="cov0" title="0">{
        if len(args) &lt; 1 </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー: テンプレート名が指定されていません")
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">templateName := args[0]
        var serverName, fromPath, command, argsStr, envStr, envFile string
        force := false

        for i := 1; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--server", "-s":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --server オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">serverName = args[i+1]
                        i++</span>
                case "--from", "-f":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --from オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">fromPath = args[i+1]
                        i++</span>
                case "--command", "-c":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --command オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">command = args[i+1]
                        i++</span>
                case "--args", "-a":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --args オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">argsStr = args[i+1]
                        i++</span>
                case "--env", "-e":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --env オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">envStr = args[i+1]
                        i++</span>
                case "--env-file":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --env-file オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">envFile = args[i+1]
                        i++</span>
                case "--force", "-F":<span class="cov0" title="0">
                        force = true</span>
                }
        }

        <span class="cov0" title="0">if err := utils.ValidateName(templateName, "サーバーテンプレート"); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">serverManager := server.NewManager(cfg.ServersDir)

        if fromPath != "" &amp;&amp; serverName != "" </span><span class="cov0" title="0">{
                if err := serverManager.SaveFromFile(templateName, serverName, fromPath, force); err != nil </span><span class="cov0" title="0">{
                        fmt.Fprintln(os.Stderr, "エラー:", err)
                        os.Exit(utils.ExitGeneralError)
                }</span>
        } else<span class="cov0" title="0"> if command != "" || argsStr != "" || envStr != "" || envFile != "" </span><span class="cov0" title="0">{
                env := make(map[string]string)
                
                if envFile != "" </span><span class="cov0" title="0">{
                        fileEnv, err := utils.LoadEnvFile(envFile)
                        if err != nil </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー:", err)
                                os.Exit(utils.ExitFileError)
                        }</span>
                        <span class="cov0" title="0">for k, v := range fileEnv </span><span class="cov0" title="0">{
                                env[k] = v
                        }</span>
                }
                
                <span class="cov0" title="0">if envStr != "" </span><span class="cov0" title="0">{
                        parsedEnv, err := utils.ParseEnvVars(envStr)
                        if err != nil </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー:", err)
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">for k, v := range parsedEnv </span><span class="cov0" title="0">{
                                env[k] = v
                        }</span>
                }
                
                <span class="cov0" title="0">parsedArgs := utils.ParseArgs(argsStr)
                
                if err := serverManager.SaveManual(templateName, command, parsedArgs, env, force); err != nil </span><span class="cov0" title="0">{
                        fmt.Fprintln(os.Stderr, "エラー:", err)
                        os.Exit(utils.ExitGeneralError)
                }</span>
        } else<span class="cov0" title="0"> {
                fmt.Fprintln(os.Stderr, "エラー: 設定ファイルからの保存には --server と --from が必要です")
                fmt.Fprintln(os.Stderr, "手動作成には --command が必要です")
                os.Exit(utils.ExitArgumentError)
        }</span>
}</pre>
		
		<pre class="file" id="file15" style="display: none">package server

import (
        "fmt"
        "os"

        "github.com/naoto24kawa/mcpconfig/cmd/server/add"
        "github.com/naoto24kawa/mcpconfig/cmd/server/delete"
        "github.com/naoto24kawa/mcpconfig/cmd/server/list"
        "github.com/naoto24kawa/mcpconfig/cmd/server/remove"
        "github.com/naoto24kawa/mcpconfig/cmd/server/rename"
        "github.com/naoto24kawa/mcpconfig/cmd/server/save"
        "github.com/naoto24kawa/mcpconfig/cmd/server/show"
        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(cfg *config.Config, args []string) <span class="cov0" title="0">{
        if len(args) == 0 </span><span class="cov0" title="0">{
                PrintUsage()
                os.Exit(0)
        }</span>

        <span class="cov0" title="0">subCmd := args[0]
        subArgs := args[1:]

        switch subCmd </span>{
        case "save":<span class="cov0" title="0">
                save.Execute(cfg, subArgs)</span>
        case "list":<span class="cov0" title="0">
                list.Execute(cfg, subArgs)</span>
        case "delete":<span class="cov0" title="0">
                delete.Execute(cfg, subArgs)</span>
        case "rename":<span class="cov0" title="0">
                rename.Execute(cfg, subArgs)</span>
        case "add":<span class="cov0" title="0">
                add.Execute(cfg, subArgs)</span>
        case "remove":<span class="cov0" title="0">
                remove.Execute(cfg, subArgs)</span>
        case "show":<span class="cov0" title="0">
                show.Execute(cfg, subArgs)</span>
        default:<span class="cov0" title="0">
                fmt.Fprintf(os.Stderr, "エラー: 不明なサブコマンド 'server %s'\n", subCmd)
                PrintUsage()
                os.Exit(utils.ExitGeneralError)</span>
        }
}

func PrintUsage() <span class="cov0" title="0">{
        fmt.Println(`mcpconfig server - MCPサーバー管理

使用方法:
  mcpconfig server &lt;サブコマンド&gt; [オプション]

サブコマンド:
  save &lt;名前&gt; --server &lt;サーバー名&gt; --from &lt;パス&gt;    設定ファイルからテンプレート保存
  save &lt;名前&gt; --command &lt;コマンド&gt; [オプション]      手動でテンプレート作成
  list [--detail]                                    テンプレート一覧表示
  delete &lt;名前&gt;                                      テンプレート削除
  rename &lt;現在の名前&gt; &lt;新しい名前&gt;                    テンプレート名変更
  add &lt;テンプレート名&gt; --to &lt;プロファイル名&gt;          プロファイルにテンプレート追加
  remove &lt;サーバー名&gt; --from &lt;プロファイル名&gt;         プロファイルからサーバー削除
  show --from &lt;パス&gt; [--server &lt;名前&gt;]               設定ファイルからサーバー情報表示`)
}</span>

</pre>
		
		<pre class="file" id="file16" style="display: none">package show

import (
        "fmt"
        "os"
        "strings"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/server"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

func Execute(cfg *config.Config, args []string) <span class="cov0" title="0">{
        var fromPath, serverName string

        for i := 0; i &lt; len(args); i++ </span><span class="cov0" title="0">{
                switch args[i] </span>{
                case "--from", "-f":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --from オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">fromPath = args[i+1]
                        i++</span>
                case "--server", "-s":<span class="cov0" title="0">
                        if i+1 &gt;= len(args) </span><span class="cov0" title="0">{
                                fmt.Fprintln(os.Stderr, "エラー: --server オプションに値が指定されていません")
                                os.Exit(utils.ExitArgumentError)
                        }</span>
                        <span class="cov0" title="0">serverName = args[i+1]
                        i++</span>
                }
        }

        <span class="cov0" title="0">if fromPath == "" </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー: 対象のMCP設定ファイルパスが指定されていません")
                fmt.Fprintln(os.Stderr, "使用方法: mcpconfig server show --from &lt;パス&gt; [--server &lt;名前&gt;]")
                os.Exit(utils.ExitArgumentError)
        }</span>

        <span class="cov0" title="0">if !utils.FileExists(fromPath) </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー: MCP設定ファイルが見つかりません:", fromPath)
                os.Exit(utils.ExitFileError)
        }</span>

        <span class="cov0" title="0">serverManager := server.NewManager(cfg.ServersDir)
        if err := serverManager.Show(fromPath, serverName); err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                if strings.Contains(err.Error(), "MCPサーバー") &amp;&amp; strings.Contains(err.Error(), "見つかりません") </span><span class="cov0" title="0">{
                        os.Exit(utils.ExitServerError)
                }</span>
                <span class="cov0" title="0">os.Exit(utils.ExitGeneralError)</span>
        }
}</pre>
		
		<pre class="file" id="file17" style="display: none">package config

import (
        "fmt"
        "os"
        "path/filepath"
)

const (
        ConfigDirName       = ".mcpconfig"
        ProfilesDir         = "profiles"
        ServersDir          = "servers"
        DefaultHomeEnv      = "HOME"
        DefaultMCPConfig    = ".mcp.json"
        DefaultDirPerm      = 0755
        FileExtension       = ".json"
        DefaultProfileName  = "default"
)

type Config struct {
        BaseDir     string
        ProfilesDir string
        ServersDir  string
}

func New() (*Config, error) <span class="cov8" title="1">{
        homeDir, err := os.UserHomeDir()
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("ホームディレクトリの取得に失敗しました: %w", err)
        }</span>

        <span class="cov8" title="1">baseDir := filepath.Join(homeDir, ConfigDirName)
        
        cfg := &amp;Config{
                BaseDir:     baseDir,
                ProfilesDir: filepath.Join(baseDir, ProfilesDir),
                ServersDir:  filepath.Join(baseDir, ServersDir),
        }

        if err := cfg.ensureDirectories(); err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return cfg, nil</span>
}

func (c *Config) ensureDirectories() error <span class="cov8" title="1">{
        dirs := []string{c.BaseDir, c.ProfilesDir, c.ServersDir}
        
        for _, dir := range dirs </span><span class="cov8" title="1">{
                if err := os.MkdirAll(dir, DefaultDirPerm); err != nil </span><span class="cov0" title="0">{
                        return fmt.Errorf("ディレクトリの作成に失敗しました %s: %w", dir, err)
                }</span>
        }
        
        <span class="cov8" title="1">return nil</span>
}

func (c *Config) GetProfilePath(name string) string <span class="cov8" title="1">{
        return filepath.Join(c.ProfilesDir, name+FileExtension)
}</span>

func (c *Config) GetServerPath(name string) string <span class="cov8" title="1">{
        return filepath.Join(c.ServersDir, name+FileExtension)
}</span>

// GetDefaultMCPConfigPath returns the default MCP configuration file path
func GetDefaultMCPConfigPath() string <span class="cov0" title="0">{
        homeDir, err := os.UserHomeDir()
        if err != nil </span><span class="cov0" title="0">{
                return DefaultMCPConfig // fallback to current directory
        }</span>
        <span class="cov0" title="0">return filepath.Join(homeDir, DefaultMCPConfig)</span>
}

// FindMCPConfigPath tries to find MCP config file in common locations
func FindMCPConfigPath() string <span class="cov0" title="0">{
        homeDir, err := os.UserHomeDir()
        if err != nil </span><span class="cov0" title="0">{
                return ""
        }</span>
        
        // Try common locations
        <span class="cov0" title="0">locations := []string{
                filepath.Join(homeDir, DefaultMCPConfig),
                filepath.Join(homeDir, ".config", "claude", "mcp.json"),
                filepath.Join(homeDir, ".config", "mcp.json"),
                "mcp.json", // current directory
        }
        
        for _, path := range locations </span><span class="cov0" title="0">{
                if _, err := os.Stat(path); err == nil </span><span class="cov0" title="0">{
                        return path
                }</span>
        }
        
        <span class="cov0" title="0">return ""</span> // not found
}</pre>
		
		<pre class="file" id="file18" style="display: none">package errors

import (
        "fmt"
)

type ErrorType int

const (
        TypeGeneral ErrorType = iota
        TypeValidation
        TypeFile
        TypeNetwork
        TypeConfig
)

type AppError struct {
        Type    ErrorType
        Message string
        Cause   error
        Code    int
}

func (e *AppError) Error() string <span class="cov8" title="1">{
        if e.Cause != nil </span><span class="cov8" title="1">{
                return fmt.Sprintf("%s: %v", e.Message, e.Cause)
        }</span>
        <span class="cov8" title="1">return e.Message</span>
}

func (e *AppError) Unwrap() error <span class="cov8" title="1">{
        return e.Cause
}</span>

func NewValidationError(message string) *AppError <span class="cov8" title="1">{
        return &amp;AppError{
                Type:    TypeValidation,
                Message: message,
                Code:    7,
        }
}</span>

func NewFileError(message string, cause error) *AppError <span class="cov8" title="1">{
        return &amp;AppError{
                Type:    TypeFile,
                Message: message,
                Cause:   cause,
                Code:    3,
        }
}</span>

func NewConfigError(message string, cause error) *AppError <span class="cov8" title="1">{
        return &amp;AppError{
                Type:    TypeConfig,
                Message: message,
                Cause:   cause,
                Code:    5,
        }
}</span>

func NewGeneralError(message string, cause error) *AppError <span class="cov8" title="1">{
        return &amp;AppError{
                Type:    TypeGeneral,
                Message: message,
                Cause:   cause,
                Code:    1,
        }
}</pre>
		
		<pre class="file" id="file19" style="display: none">package interaction

import (
        "bufio"
        "fmt"
        "os"
        "strings"
)

func IsInteractive() bool <span class="cov8" title="1">{
        stat, _ := os.Stdin.Stat()
        return (stat.Mode() &amp; os.ModeCharDevice) != 0
}</span>

func ConfirmOverwrite(resourceType, name string) bool <span class="cov8" title="1">{
        if !IsInteractive() </span><span class="cov0" title="0">{
                return false
        }</span>
        
        <span class="cov8" title="1">fmt.Printf("警告: %s '%s' は既に存在します\n", resourceType, name)
        fmt.Print("上書きしますか？ (y/N): ")
        
        reader := bufio.NewReader(os.Stdin)
        input, err := reader.ReadString('\n')
        if err != nil </span><span class="cov8" title="1">{
                return false
        }</span>
        
        <span class="cov0" title="0">input = strings.TrimSpace(strings.ToLower(input))
        return input == "y" || input == "yes"</span>
}

func Confirm(message string) bool <span class="cov8" title="1">{
        if !IsInteractive() </span><span class="cov0" title="0">{
                return false
        }</span>
        
        <span class="cov8" title="1">fmt.Printf("%s (y/N): ", message)
        
        reader := bufio.NewReader(os.Stdin)
        input, err := reader.ReadString('\n')
        if err != nil </span><span class="cov8" title="1">{
                return false
        }</span>
        
        <span class="cov0" title="0">input = strings.TrimSpace(strings.ToLower(input))
        return input == "y" || input == "yes"</span>
}</pre>
		
		<pre class="file" id="file20" style="display: none">package mcpconfig

import (
        "fmt"
        "os"
        "path/filepath"
        "time"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/server"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

// MCPConfigManager handles MCP configuration file operations
type MCPConfigManager struct{}

// NewMCPConfigManager creates a new MCPConfigManager instance
func NewMCPConfigManager() *MCPConfigManager <span class="cov0" title="0">{
        return &amp;MCPConfigManager{}
}</span>

// Load loads an MCP configuration from file
func (m *MCPConfigManager) Load(mcpConfigPath string) (*server.MCPConfig, error) <span class="cov0" title="0">{
        mcpConfig := &amp;server.MCPConfig{}
        if err := utils.LoadJSON(mcpConfigPath, mcpConfig); err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("MCP設定ファイルの読み込みに失敗しました: %w", err)
        }</span>
        <span class="cov0" title="0">return mcpConfig, nil</span>
}

// Save saves an MCP configuration to file
func (m *MCPConfigManager) Save(mcpConfig *server.MCPConfig, targetPath string) error <span class="cov0" title="0">{
        targetDir := filepath.Dir(targetPath)
        if err := os.MkdirAll(targetDir, config.DefaultDirPerm); err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("ディレクトリの作成に失敗しました: %w", err)
        }</span>

        <span class="cov0" title="0">if err := utils.SaveJSON(targetPath, mcpConfig); err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("MCP設定ファイルの保存に失敗しました: %w", err)
        }</span>

        <span class="cov0" title="0">return nil</span>
}

// BuildFromProfile builds an MCP configuration from profile and server templates
func (m *MCPConfigManager) BuildFromProfile(profile *ProfileData, serverManager *server.Manager) (*server.MCPConfig, error) <span class="cov0" title="0">{
        mcpConfig := &amp;server.MCPConfig{
                McpServers: make(map[string]server.MCPServer),
        }

        for _, serverRef := range profile.Servers </span><span class="cov0" title="0">{
                serverTemplate, err := serverManager.Load(serverRef.Template)
                if err != nil </span><span class="cov0" title="0">{
                        return nil, fmt.Errorf("サーバーテンプレート '%s' の読み込みに失敗しました: %w", serverRef.Template, err)
                }</span>

                <span class="cov0" title="0">mcpServer := m.createMCPServer(serverTemplate, &amp;serverRef)
                mcpConfig.McpServers[serverRef.Name] = mcpServer</span>
        }

        <span class="cov0" title="0">return mcpConfig, nil</span>
}

func (m *MCPConfigManager) createMCPServer(template *server.ServerTemplate, serverRef *ServerRef) server.MCPServer <span class="cov0" title="0">{
        mcpServer := server.MCPServer{
                Command:       template.ServerConfig.Command,
                Args:          template.ServerConfig.Args,
                Env:           make(map[string]string),
                Timeout:       template.ServerConfig.Timeout,
                EnvFile:       template.ServerConfig.EnvFile,
                TransportType: template.ServerConfig.TransportType,
        }

        // Copy template environment variables
        for k, v := range template.ServerConfig.Env </span><span class="cov0" title="0">{
                mcpServer.Env[k] = v
        }</span>

        // Apply overrides
        <span class="cov0" title="0">for k, v := range serverRef.Overrides.Env </span><span class="cov0" title="0">{
                mcpServer.Env[k] = v
        }</span>

        <span class="cov0" title="0">return mcpServer</span>
}

// ProfileData represents profile data structure
type ProfileData struct {
        Name        string      `json:"name"`
        Description string      `json:"description"`
        CreatedAt   time.Time   `json:"createdAt"`
        UpdatedAt   time.Time   `json:"updatedAt"`
        Servers     []ServerRef `json:"servers"`
}

// ServerRef represents a server reference in a profile
type ServerRef struct {
        Name      string           `json:"name"`
        Template  string           `json:"template"`
        Overrides ServerOverrides  `json:"overrides,omitempty"`
}

// ServerOverrides represents environment variable overrides
type ServerOverrides struct {
        Env map[string]string `json:"env,omitempty"`
}</pre>
		
		<pre class="file" id="file21" style="display: none">package profile

import (
        "fmt"
        "os"
        "path/filepath"
        "strings"
        "time"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/interaction"
        "github.com/naoto24kawa/mcpconfig/internal/mcpconfig"
        "github.com/naoto24kawa/mcpconfig/internal/server"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

const (
        ListColumnWidth     = 20
        TimestampFormat     = "2006-01-02 15:04:05"
        TableSeparatorChar  = "-"
        TableSeparatorWidth = 60
)

type Profile struct {
        Name        string           `json:"name"`
        Description string           `json:"description"`
        CreatedAt   time.Time        `json:"createdAt"`
        UpdatedAt   time.Time        `json:"updatedAt"`
        Servers     []ServerRef      `json:"servers"`
}

type ServerRef = mcpconfig.ServerRef
type ServerOverrides = mcpconfig.ServerOverrides


type Manager struct {
        profilesDir string
}

func NewManager(profilesDir string) *Manager <span class="cov8" title="1">{
        return &amp;Manager{
                profilesDir: profilesDir,
        }
}</span>

func (m *Manager) Create(name, description string) error <span class="cov8" title="1">{
        profilePath := m.getProfilePath(name)
        
        if _, err := os.Stat(profilePath); err == nil </span><span class="cov8" title="1">{
                return fmt.Errorf("プロファイル '%s' は既に存在します", name)
        }</span>
        
        <span class="cov8" title="1">profile := &amp;Profile{
                Name:        name,
                Description: description,
                CreatedAt:   time.Now(),
                UpdatedAt:   time.Now(),
                Servers:     []ServerRef{},
        }
        
        return m.saveProfile(profile)</span>
}

func (m *Manager) Save(name string, mcpConfigPath string, serverManager *server.Manager, force bool) error <span class="cov8" title="1">{
        if err := m.validateProfileCreation(name, force); err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        
        <span class="cov8" title="1">profile, err := m.buildProfileFromMCP(name, mcpConfigPath, serverManager)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        
        <span class="cov8" title="1">if err := m.saveProfile(profile); err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        
        <span class="cov8" title="1">fmt.Printf("プロファイル '%s' を保存しました (%d個のサーバー)\n", name, len(profile.Servers))
        return nil</span>
}

func (m *Manager) buildProfileFromMCP(name, mcpConfigPath string, serverManager *server.Manager) (*Profile, error) <span class="cov8" title="1">{
        mcpConfig, err := m.loadMCPConfig(mcpConfigPath)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        
        <span class="cov8" title="1">profile := m.createProfileFromMCP(name, mcpConfigPath)
        
        if err := m.processServers(profile, mcpConfig, serverManager); err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        
        <span class="cov8" title="1">return profile, nil</span>
}

func (m *Manager) validateProfileCreation(name string, force bool) error <span class="cov8" title="1">{
        profilePath := filepath.Join(m.profilesDir, name+config.FileExtension)
        
        if _, err := os.Stat(profilePath); err == nil &amp;&amp; !force </span><span class="cov8" title="1">{
                return fmt.Errorf("プロファイル '%s' は既に存在します。--force オプションで上書きしてください", name)
        }</span>
        
        <span class="cov8" title="1">return nil</span>
}

func (m *Manager) loadMCPConfig(mcpConfigPath string) (*server.MCPConfig, error) <span class="cov8" title="1">{
        mcpManager := mcpconfig.NewMCPConfigManager()
        return mcpManager.Load(mcpConfigPath)
}</span>

func (m *Manager) createProfileFromMCP(name, mcpConfigPath string) *Profile <span class="cov8" title="1">{
        return &amp;Profile{
                Name:        name,
                Description: fmt.Sprintf("%s から保存", mcpConfigPath),
                CreatedAt:   time.Now(),
                UpdatedAt:   time.Now(),
                Servers:     []ServerRef{},
        }
}</span>

func (m *Manager) processServers(profile *Profile, mcpConfig *server.MCPConfig, serverManager *server.Manager) error <span class="cov8" title="1">{
        for serverName, mcpServer := range mcpConfig.McpServers </span><span class="cov8" title="1">{
                if err := m.processServer(profile, serverName, mcpServer, serverManager); err != nil </span><span class="cov0" title="0">{
                        return err
                }</span>
        }
        <span class="cov8" title="1">return nil</span>
}

func (m *Manager) processServer(profile *Profile, serverName string, mcpServer server.MCPServer, serverManager *server.Manager) error <span class="cov8" title="1">{
        templateName := serverName
        
        if err := m.ensureServerTemplate(templateName, mcpServer, serverManager); err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        
        <span class="cov8" title="1">profile.Servers = append(profile.Servers, ServerRef{
                Name:     serverName,
                Template: templateName,
        })
        return nil</span>
}

func (m *Manager) ensureServerTemplate(templateName string, mcpServer server.MCPServer, serverManager *server.Manager) error <span class="cov8" title="1">{
        exists, err := serverManager.Exists(templateName)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        
        <span class="cov8" title="1">if !exists </span><span class="cov8" title="1">{
                if err := m.createServerTemplate(templateName, mcpServer, serverManager); err != nil </span><span class="cov0" title="0">{
                        return err
                }</span>
                <span class="cov8" title="1">fmt.Printf("サーバーテンプレート '%s' を作成しました\n", templateName)</span>
        } else<span class="cov0" title="0"> {
                fmt.Printf("サーバーテンプレート '%s' は既に存在するため、既存のものを使用します\n", templateName)
        }</span>
        <span class="cov8" title="1">return nil</span>
}

func (m *Manager) createServerTemplate(templateName string, mcpServer server.MCPServer, serverManager *server.Manager) error <span class="cov8" title="1">{
        serverConfig := server.MCPServer{
                Command:       mcpServer.Command,
                Args:          mcpServer.Args,
                Env:           mcpServer.Env,
                Timeout:       mcpServer.Timeout,
                EnvFile:       mcpServer.EnvFile,
                TransportType: mcpServer.TransportType,
        }
        return serverManager.SaveFromConfig(templateName, serverConfig)
}</span>

func (m *Manager) Apply(name string, targetPath string, serverManager *server.Manager) error <span class="cov8" title="1">{
        profile, err := m.Load(name)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        
        <span class="cov8" title="1">mcpManager := mcpconfig.NewMCPConfigManager()
        mcpConfig, err := mcpManager.BuildFromProfile((*mcpconfig.ProfileData)(profile), serverManager)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        
        <span class="cov8" title="1">if err := mcpManager.Save(mcpConfig, targetPath); err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        
        <span class="cov8" title="1">fmt.Printf("プロファイル '%s' を適用しました\n", name)
        fmt.Printf("%d個のサーバー設定を '%s' に保存\n", len(profile.Servers), targetPath)
        return nil</span>
}

func (m *Manager) List(detail bool) error <span class="cov8" title="1">{
        files, err := os.ReadDir(m.profilesDir)
        if err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("プロファイルディレクトリの読み込みに失敗しました: %w", err)
        }</span>
        
        <span class="cov8" title="1">if len(files) == 0 </span><span class="cov8" title="1">{
                fmt.Println("プロファイルが存在しません")
                return nil
        }</span>
        
        <span class="cov8" title="1">if detail </span><span class="cov8" title="1">{
                return m.listDetailed(files)
        }</span>
        <span class="cov8" title="1">return m.listSummary(files)</span>
}

func (m *Manager) listDetailed(files []os.DirEntry) error <span class="cov8" title="1">{
        for _, file := range files </span><span class="cov8" title="1">{
                if strings.HasSuffix(file.Name(), config.FileExtension) </span><span class="cov8" title="1">{
                        name := strings.TrimSuffix(file.Name(), config.FileExtension)
                        profile, err := m.Load(name)
                        if err != nil </span><span class="cov0" title="0">{
                                fmt.Printf("エラー: %s の読み込みに失敗しました: %v\n", name, err)
                                continue</span>
                        }
                        
                        <span class="cov8" title="1">m.printProfileDetails(profile)</span>
                }
        }
        <span class="cov8" title="1">return nil</span>
}

func (m *Manager) listSummary(files []os.DirEntry) error <span class="cov8" title="1">{
        fmt.Printf("%-*s %-*s %s\n", ListColumnWidth, "プロファイル名", ListColumnWidth, "作成日時", "サーバー数")
        fmt.Println(strings.Repeat(TableSeparatorChar, TableSeparatorWidth))
        
        for _, file := range files </span><span class="cov8" title="1">{
                if strings.HasSuffix(file.Name(), config.FileExtension) </span><span class="cov8" title="1">{
                        name := strings.TrimSuffix(file.Name(), config.FileExtension)
                        profile, err := m.Load(name)
                        if err != nil </span><span class="cov0" title="0">{
                                continue</span>
                        }
                        
                        <span class="cov8" title="1">fmt.Printf("%-*s %-*s %d\n",
                                ListColumnWidth, profile.Name,
                                ListColumnWidth, profile.CreatedAt.Format(TimestampFormat),
                                len(profile.Servers))</span>
                }
        }
        <span class="cov8" title="1">return nil</span>
}

func (m *Manager) printProfileDetails(profile *Profile) <span class="cov8" title="1">{
        fmt.Printf("\nプロファイル: %s\n", profile.Name)
        fmt.Printf("  説明: %s\n", profile.Description)
        fmt.Printf("  作成日時: %s\n", profile.CreatedAt.Format(TimestampFormat))
        fmt.Printf("  更新日時: %s\n", profile.UpdatedAt.Format(TimestampFormat))
        fmt.Printf("  サーバー数: %d\n", len(profile.Servers))
        
        if len(profile.Servers) &gt; 0 </span><span class="cov0" title="0">{
                fmt.Println("  サーバー:")
                for _, server := range profile.Servers </span><span class="cov0" title="0">{
                        fmt.Printf("    - %s (テンプレート: %s)\n", server.Name, server.Template)
                }</span>
        }
}

func (m *Manager) Delete(name string, force bool) error <span class="cov8" title="1">{
        profilePath := m.getProfilePath(name)
        
        if _, err := os.Stat(profilePath); os.IsNotExist(err) </span><span class="cov8" title="1">{
                return fmt.Errorf("プロファイル '%s' が見つかりません", name)
        }</span>
        
        <span class="cov8" title="1">if !force </span><span class="cov0" title="0">{
                if !interaction.Confirm(fmt.Sprintf("プロファイル '%s' を削除しますか？", name)) </span><span class="cov0" title="0">{
                        fmt.Println("削除をキャンセルしました")
                        return nil
                }</span>
        }
        
        <span class="cov8" title="1">if err := os.Remove(profilePath); err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("プロファイルの削除に失敗しました: %w", err)
        }</span>
        
        <span class="cov8" title="1">fmt.Printf("プロファイル '%s' を削除しました\n", name)
        return nil</span>
}

func (m *Manager) Rename(oldName, newName string, force bool) error <span class="cov8" title="1">{
        oldPath := m.getProfilePath(oldName)
        newPath := m.getProfilePath(newName)
        
        if _, err := os.Stat(oldPath); os.IsNotExist(err) </span><span class="cov8" title="1">{
                return fmt.Errorf("プロファイル '%s' が見つかりません", oldName)
        }</span>
        
        <span class="cov8" title="1">if _, err := os.Stat(newPath); err == nil &amp;&amp; !force </span><span class="cov8" title="1">{
                return fmt.Errorf("プロファイル '%s' は既に存在します。別の名前を指定するか、--force オプションで上書きしてください", newName)
        }</span>
        
        <span class="cov8" title="1">profile, err := m.Load(oldName)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        
        <span class="cov8" title="1">profile.Name = newName
        profile.UpdatedAt = time.Now()
        
        if err := m.saveProfile(profile); err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        
        <span class="cov8" title="1">if err := os.Remove(oldPath); err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("古いプロファイルの削除に失敗しました: %w", err)
        }</span>
        
        <span class="cov8" title="1">fmt.Printf("プロファイル '%s' を '%s' に変更しました\n", oldName, newName)
        return nil</span>
}


func (m *Manager) Load(name string) (*Profile, error) <span class="cov8" title="1">{
        profilePath := m.getProfilePath(name)
        
        profile := &amp;Profile{}
        if err := utils.LoadJSON(profilePath, profile); err != nil </span><span class="cov8" title="1">{
                if os.IsNotExist(err) </span><span class="cov8" title="1">{
                        return nil, fmt.Errorf("プロファイル '%s' が見つかりません", name)
                }</span>
                <span class="cov0" title="0">return nil, fmt.Errorf("プロファイルの読み込みに失敗しました: %w", err)</span>
        }
        
        <span class="cov8" title="1">return profile, nil</span>
}

func (m *Manager) getProfilePath(name string) string <span class="cov8" title="1">{
        return filepath.Join(m.profilesDir, name+config.FileExtension)
}</span>

func (m *Manager) saveProfile(profile *Profile) error <span class="cov8" title="1">{
        profilePath := m.getProfilePath(profile.Name)
        return utils.SaveJSON(profilePath, profile)
}</span>

func (m *Manager) AddServer(profileName, templateName, serverName string, envOverrides map[string]string) error <span class="cov8" title="1">{
        profile, err := m.Load(profileName)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        
        <span class="cov8" title="1">if serverName == "" </span><span class="cov8" title="1">{
                serverName = templateName
        }</span>
        
        <span class="cov8" title="1">for _, server := range profile.Servers </span><span class="cov8" title="1">{
                if server.Name == serverName </span><span class="cov8" title="1">{
                        return fmt.Errorf("サーバー名 '%s' は既にプロファイル '%s' に存在します。別の名前を指定してください（--as オプションを使用）", serverName, profileName)
                }</span>
        }
        
        <span class="cov8" title="1">serverRef := ServerRef{
                Name:     serverName,
                Template: templateName,
        }
        
        if len(envOverrides) &gt; 0 </span><span class="cov8" title="1">{
                serverRef.Overrides.Env = envOverrides
        }</span>
        
        <span class="cov8" title="1">profile.Servers = append(profile.Servers, serverRef)
        profile.UpdatedAt = time.Now()
        
        if err := m.saveProfile(profile); err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        
        <span class="cov8" title="1">fmt.Printf("サーバー '%s' をプロファイル '%s' に追加しました\n", serverName, profileName)
        return nil</span>
}

func (m *Manager) RemoveServer(profileName, serverName string) error <span class="cov8" title="1">{
        profile, err := m.Load(profileName)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        
        <span class="cov8" title="1">found := false
        newServers := []ServerRef{}
        
        for _, server := range profile.Servers </span><span class="cov8" title="1">{
                if server.Name != serverName </span><span class="cov0" title="0">{
                        newServers = append(newServers, server)
                }</span> else<span class="cov8" title="1"> {
                        found = true
                }</span>
        }
        
        <span class="cov8" title="1">if !found </span><span class="cov8" title="1">{
                return fmt.Errorf("サーバー '%s' がプロファイル '%s' に見つかりません", serverName, profileName)
        }</span>
        
        <span class="cov8" title="1">profile.Servers = newServers
        profile.UpdatedAt = time.Now()
        
        if err := m.saveProfile(profile); err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        
        <span class="cov8" title="1">fmt.Printf("サーバー '%s' をプロファイル '%s' から削除しました\n", serverName, profileName)
        return nil</span>
}

func (m *Manager) Reset(force bool) error <span class="cov8" title="1">{
        if _, err := os.Stat(m.profilesDir); os.IsNotExist(err) </span><span class="cov8" title="1">{
                fmt.Println("プロファイルディレクトリが存在しません")
                return nil
        }</span>
        
        <span class="cov8" title="1">files, err := os.ReadDir(m.profilesDir)
        if err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("プロファイルディレクトリの読み込みに失敗しました: %w", err)
        }</span>
        
        <span class="cov8" title="1">profileFiles := []string{}
        for _, file := range files </span><span class="cov8" title="1">{
                if strings.HasSuffix(file.Name(), config.FileExtension) </span><span class="cov8" title="1">{
                        profileFiles = append(profileFiles, file.Name())
                }</span>
        }
        
        <span class="cov8" title="1">if len(profileFiles) == 0 </span><span class="cov8" title="1">{
                fmt.Println("削除するプロファイルが存在しません")
                return nil
        }</span>
        
        <span class="cov8" title="1">if !force </span><span class="cov0" title="0">{
                fmt.Printf("以下の%d個のプロファイルを削除します:\n", len(profileFiles))
                for _, file := range profileFiles </span><span class="cov0" title="0">{
                        name := strings.TrimSuffix(file, config.FileExtension)
                        fmt.Printf("  - %s\n", name)
                }</span>
                <span class="cov0" title="0">fmt.Println()
                
                if !interaction.Confirm("すべてのプロファイルを削除しますか？") </span><span class="cov0" title="0">{
                        fmt.Println("リセットをキャンセルしました")
                        return nil
                }</span>
        }
        
        <span class="cov8" title="1">deletedCount := 0
        for _, file := range profileFiles </span><span class="cov8" title="1">{
                profilePath := filepath.Join(m.profilesDir, file)
                if err := os.Remove(profilePath); err != nil </span><span class="cov0" title="0">{
                        fmt.Printf("警告: %s の削除に失敗しました: %v\n", file, err)
                }</span> else<span class="cov8" title="1"> {
                        deletedCount++
                }</span>
        }
        
        <span class="cov8" title="1">fmt.Printf("プロファイルを%d個削除しました\n", deletedCount)
        return nil</span>
}



</pre>
		
		<pre class="file" id="file22" style="display: none">package server

import "time"

// CreateServerTemplate creates a new ServerTemplate instance
func CreateServerTemplate(name, command string, args []string, env map[string]string) *ServerTemplate <span class="cov8" title="1">{
        return &amp;ServerTemplate{
                Name:        name,
                Description: nil,
                CreatedAt:   time.Now(),
                ServerConfig: ServerConfig{
                        Command: command,
                        Args:    args,
                        Env:     env,
                },
        }
}</pre>
		
		<pre class="file" id="file23" style="display: none">package server

import (
        "fmt"
        "time"

        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

const (
        ListColumnWidth     = 20
        TimestampFormat     = "2006-01-02 15:04:05"
)

type ServerTemplate struct {
        Name         string       `json:"name"`
        Description  *string      `json:"description"`
        CreatedAt    time.Time    `json:"createdAt"`
        ServerConfig ServerConfig `json:"serverConfig"`
}

type ServerConfig struct {
        Command       string            `json:"command"`
        Args          []string          `json:"args,omitempty"`
        Env           map[string]string `json:"env,omitempty"`
        Timeout       *int              `json:"timeout,omitempty"`
        EnvFile       *string           `json:"envFile,omitempty"`
        TransportType *string           `json:"transportType,omitempty"`
}

type MCPServer struct {
        Command       string            `json:"command"`
        Args          []string          `json:"args,omitempty"`
        Env           map[string]string `json:"env,omitempty"`
        Timeout       *int              `json:"timeout,omitempty"`
        EnvFile       *string           `json:"envFile,omitempty"`
        TransportType *string           `json:"transportType,omitempty"`
}

type MCPConfig struct {
        McpServers map[string]MCPServer `json:"mcpServers"`
}

// Manager is a unified manager for server templates
type Manager struct {
        templateManager *TemplateManager
        templateUpdater *TemplateUpdater
        templateDisplay *TemplateDisplay
}

// NewManager creates a new unified Manager instance
func NewManager(serversDir string) *Manager <span class="cov8" title="1">{
        templateManager := NewTemplateManager(serversDir)
        return &amp;Manager{
                templateManager: templateManager,
                templateUpdater: NewTemplateUpdater(templateManager),
                templateDisplay: NewTemplateDisplay(serversDir),
        }
}</span>

// SaveFromFile saves a server template from an MCP config file
func (m *Manager) SaveFromFile(templateName, serverName, mcpConfigPath string, force bool) error <span class="cov0" title="0">{
        return m.templateManager.SaveFromFile(templateName, serverName, mcpConfigPath, force)
}</span>

// SaveManual saves or updates a server template manually
func (m *Manager) SaveManual(templateName, command string, args []string, env map[string]string, force bool) error <span class="cov8" title="1">{
        return m.templateUpdater.SaveManual(templateName, command, args, env, force)
}</span>


// List displays all server templates
func (m *Manager) List(detail bool) error <span class="cov0" title="0">{
        return m.templateDisplay.List(detail)
}</span>

// Delete deletes a server template
func (m *Manager) Delete(name string, force bool) error <span class="cov8" title="1">{
        return m.templateManager.Delete(name, force)
}</span>

// Rename renames a server template
func (m *Manager) Rename(oldName, newName string, force bool) error <span class="cov0" title="0">{
        return m.templateManager.Rename(oldName, newName, force)
}</span>

func (m *Manager) Show(mcpConfigPath string, serverName string) error <span class="cov0" title="0">{
        mcpConfig := &amp;MCPConfig{}
        if err := utils.LoadJSON(mcpConfigPath, mcpConfig); err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("MCP設定ファイルの読み込みに失敗しました: %w", err)
        }</span>
        
        <span class="cov0" title="0">if serverName != "" </span><span class="cov0" title="0">{
                server, exists := mcpConfig.McpServers[serverName]
                if !exists </span><span class="cov0" title="0">{
                        availableServers := make([]string, 0, len(mcpConfig.McpServers))
                        for name := range mcpConfig.McpServers </span><span class="cov0" title="0">{
                                availableServers = append(availableServers, name)
                        }</span>
                        <span class="cov0" title="0">return fmt.Errorf("MCPサーバー '%s' がMCP設定ファイルに見つかりません\nファイル: %s\n利用可能なサーバー: %v", 
                                serverName, mcpConfigPath, availableServers)</span>
                }
                
                <span class="cov0" title="0">fmt.Printf("サーバー名: %s\n", serverName)
                fmt.Printf("  コマンド: %s\n", server.Command)
                if len(server.Args) &gt; 0 </span><span class="cov0" title="0">{
                        fmt.Printf("  引数: %v\n", server.Args)
                }</span>
                <span class="cov0" title="0">if len(server.Env) &gt; 0 </span><span class="cov0" title="0">{
                        fmt.Println("  環境変数:")
                        for k, v := range server.Env </span><span class="cov0" title="0">{
                                fmt.Printf("    %s: %s\n", k, v)
                        }</span>
                }
        } else<span class="cov0" title="0"> {
                if len(mcpConfig.McpServers) == 0 </span><span class="cov0" title="0">{
                        fmt.Println("MCPサーバーが設定されていません")
                        return nil
                }</span>
                
                <span class="cov0" title="0">for name, server := range mcpConfig.McpServers </span><span class="cov0" title="0">{
                        fmt.Printf("サーバー名: %s\n", name)
                        fmt.Printf("  コマンド: %s\n", server.Command)
                        if len(server.Args) &gt; 0 </span><span class="cov0" title="0">{
                                fmt.Printf("  引数: %v\n", server.Args)
                        }</span>
                        <span class="cov0" title="0">if len(server.Env) &gt; 0 </span><span class="cov0" title="0">{
                                fmt.Println("  環境変数:")
                                for k, v := range server.Env </span><span class="cov0" title="0">{
                                        fmt.Printf("    %s: %s\n", k, v)
                                }</span>
                        }
                        <span class="cov0" title="0">fmt.Println()</span>
                }
        }
        
        <span class="cov0" title="0">return nil</span>
}

// Load loads a server template by name
func (m *Manager) Load(name string) (*ServerTemplate, error) <span class="cov8" title="1">{
        return m.templateManager.Load(name)
}</span>

// Exists checks if a server template exists
func (m *Manager) Exists(name string) (bool, error) <span class="cov8" title="1">{
        return m.templateManager.Exists(name)
}</span>

// SaveFromConfig saves a server template from MCPServer config
func (m *Manager) SaveFromConfig(name string, server MCPServer) error <span class="cov0" title="0">{
        return m.templateManager.SaveFromConfig(name, server)
}</span>

// Reset deletes all server templates
func (m *Manager) Reset(force bool) error <span class="cov8" title="1">{
        return m.templateManager.Reset(force)
}</span>

</pre>
		
		<pre class="file" id="file24" style="display: none">package server

import (
        "fmt"
        "os"
        "strings"

        "github.com/naoto24kawa/mcpconfig/internal/config"
)

// TemplateDisplay handles template listing and display operations
type TemplateDisplay struct {
        serversDir string
}

// NewTemplateDisplay creates a new TemplateDisplay instance
func NewTemplateDisplay(serversDir string) *TemplateDisplay <span class="cov8" title="1">{
        return &amp;TemplateDisplay{
                serversDir: serversDir,
        }
}</span>

// List displays all server templates
func (td *TemplateDisplay) List(detail bool) error <span class="cov8" title="1">{
        files, err := os.ReadDir(td.serversDir)
        if err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("サーバーディレクトリの読み込みに失敗しました: %w", err)
        }</span>

        <span class="cov8" title="1">if len(files) == 0 </span><span class="cov8" title="1">{
                fmt.Println("サーバーテンプレートが存在しません")
                return nil
        }</span>

        <span class="cov8" title="1">if detail </span><span class="cov8" title="1">{
                return td.listDetailed(files)
        }</span>

        <span class="cov8" title="1">return td.listSummary(files)</span>
}

func (td *TemplateDisplay) listDetailed(files []os.DirEntry) error <span class="cov8" title="1">{
        templateManager := NewTemplateManager(td.serversDir)

        for _, file := range files </span><span class="cov8" title="1">{
                if strings.HasSuffix(file.Name(), config.FileExtension) </span><span class="cov8" title="1">{
                        name := strings.TrimSuffix(file.Name(), config.FileExtension)
                        template, err := templateManager.Load(name)
                        if err != nil </span><span class="cov8" title="1">{
                                fmt.Printf("エラー: %s の読み込みに失敗しました: %v\n", name, err)
                                continue</span>
                        }

                        <span class="cov8" title="1">td.displayTemplateDetail(template)</span>
                }
        }
        <span class="cov8" title="1">return nil</span>
}

func (td *TemplateDisplay) listSummary(files []os.DirEntry) error <span class="cov8" title="1">{
        templateManager := NewTemplateManager(td.serversDir)

        fmt.Printf("%-20s %-20s %s\n", "テンプレート名", "作成日時", "コマンド")
        fmt.Println(strings.Repeat("-", 60))

        for _, file := range files </span><span class="cov8" title="1">{
                if strings.HasSuffix(file.Name(), config.FileExtension) </span><span class="cov8" title="1">{
                        name := strings.TrimSuffix(file.Name(), config.FileExtension)
                        template, err := templateManager.Load(name)
                        if err != nil </span><span class="cov8" title="1">{
                                continue</span>
                        }

                        <span class="cov8" title="1">fmt.Printf("%-*s %-*s %s\n",
                                ListColumnWidth, template.Name,
                                ListColumnWidth, template.CreatedAt.Format(TimestampFormat),
                                template.ServerConfig.Command)</span>
                }
        }
        <span class="cov8" title="1">return nil</span>
}

func (td *TemplateDisplay) displayTemplateDetail(template *ServerTemplate) <span class="cov8" title="1">{
        fmt.Printf("\nテンプレート: %s\n", template.Name)
        if template.Description != nil </span><span class="cov8" title="1">{
                fmt.Printf("  説明: %s\n", *template.Description)
        }</span>
        <span class="cov8" title="1">fmt.Printf("  作成日時: %s\n", template.CreatedAt.Format("2006-01-02 15:04:05"))
        fmt.Printf("  コマンド: %s\n", template.ServerConfig.Command)
        if len(template.ServerConfig.Args) &gt; 0 </span><span class="cov8" title="1">{
                fmt.Printf("  引数: %v\n", template.ServerConfig.Args)
        }</span>
        <span class="cov8" title="1">if len(template.ServerConfig.Env) &gt; 0 </span><span class="cov8" title="1">{
                fmt.Println("  環境変数:")
                for k, v := range template.ServerConfig.Env </span><span class="cov8" title="1">{
                        fmt.Printf("    %s=%s\n", k, v)
                }</span>
        }
}</pre>
		
		<pre class="file" id="file25" style="display: none">package server

import (
        "fmt"
        "os"
        "path/filepath"
        "strings"
        "time"

        "github.com/naoto24kawa/mcpconfig/internal/config"
        "github.com/naoto24kawa/mcpconfig/internal/interaction"
        "github.com/naoto24kawa/mcpconfig/internal/utils"
)

// TemplateManager handles server template CRUD operations
type TemplateManager struct {
        serversDir string
}

// NewTemplateManager creates a new TemplateManager instance
func NewTemplateManager(serversDir string) *TemplateManager <span class="cov8" title="1">{
        return &amp;TemplateManager{
                serversDir: serversDir,
        }
}</span>

// SaveFromFile saves a server template from an MCP config file
func (tm *TemplateManager) SaveFromFile(templateName, serverName, mcpConfigPath string, force bool) error <span class="cov8" title="1">{
        if !force &amp;&amp; tm.exists(templateName) </span><span class="cov0" title="0">{
                if !interaction.ConfirmOverwrite("サーバーテンプレート", templateName) </span><span class="cov0" title="0">{
                        return fmt.Errorf("上書きをキャンセルしました")
                }</span>
        }

        <span class="cov8" title="1">mcpConfig := &amp;MCPConfig{}
        if err := utils.LoadJSON(mcpConfigPath, mcpConfig); err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("MCP設定ファイルの読み込みに失敗しました: %w", err)
        }</span>

        <span class="cov8" title="1">server, exists := mcpConfig.McpServers[serverName]
        if !exists </span><span class="cov8" title="1">{
                return fmt.Errorf("MCPサーバー '%s' がMCP設定ファイルに見つかりません", serverName)
        }</span>

        <span class="cov8" title="1">template := &amp;ServerTemplate{
                Name:         templateName,
                Description:  nil,
                CreatedAt:    time.Now(),
                ServerConfig: ServerConfig(server),
        }

        if err := tm.save(template); err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov8" title="1">fmt.Printf("サーバーテンプレート '%s' を保存しました\n", templateName)
        fmt.Printf("コマンド: %s\n", server.Command)
        if len(server.Args) &gt; 0 </span><span class="cov8" title="1">{
                fmt.Printf("引数: %v\n", server.Args)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

// SaveFromConfig saves a server template from MCPServer config
func (tm *TemplateManager) SaveFromConfig(name string, server MCPServer) error <span class="cov8" title="1">{
        template := &amp;ServerTemplate{
                Name:         name,
                Description:  nil,
                CreatedAt:    time.Now(),
                ServerConfig: ServerConfig(server),
        }

        return tm.save(template)
}</span>

// Load loads a server template by name
func (tm *TemplateManager) Load(name string) (*ServerTemplate, error) <span class="cov8" title="1">{
        templatePath := filepath.Join(tm.serversDir, name+config.FileExtension)

        template := &amp;ServerTemplate{}
        if err := utils.LoadJSON(templatePath, template); err != nil </span><span class="cov8" title="1">{
                if os.IsNotExist(err) </span><span class="cov8" title="1">{
                        return nil, fmt.Errorf("サーバーテンプレート '%s' が見つかりません", name)
                }</span>
                <span class="cov8" title="1">return nil, fmt.Errorf("サーバーテンプレートの読み込みに失敗しました: %w", err)</span>
        }

        <span class="cov8" title="1">return template, nil</span>
}

// Exists checks if a server template exists
func (tm *TemplateManager) Exists(name string) (bool, error) <span class="cov8" title="1">{
        return tm.exists(name), nil
}</span>

// Delete deletes a server template
func (tm *TemplateManager) Delete(name string, force bool) error <span class="cov8" title="1">{
        templatePath := filepath.Join(tm.serversDir, name+config.FileExtension)

        if _, err := os.Stat(templatePath); os.IsNotExist(err) </span><span class="cov8" title="1">{
                return fmt.Errorf("サーバーテンプレート '%s' が見つかりません", name)
        }</span>

        <span class="cov8" title="1">if !force </span><span class="cov0" title="0">{
                if !interaction.Confirm(fmt.Sprintf("サーバーテンプレート '%s' を削除しますか？", name)) </span><span class="cov0" title="0">{
                        fmt.Println("削除をキャンセルしました")
                        return nil
                }</span>
        }

        <span class="cov8" title="1">if err := os.Remove(templatePath); err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("サーバーテンプレートの削除に失敗しました: %w", err)
        }</span>

        <span class="cov8" title="1">fmt.Printf("サーバーテンプレート '%s' を削除しました\n", name)
        return nil</span>
}

// Rename renames a server template
func (tm *TemplateManager) Rename(oldName, newName string, force bool) error <span class="cov8" title="1">{
        if err := tm.validateRename(oldName, newName, force); err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">template, err := tm.Load(oldName)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov8" title="1">if err := tm.performRename(template, oldName, newName); err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov8" title="1">fmt.Printf("サーバーテンプレート '%s' を '%s' に変更しました\n", oldName, newName)
        return nil</span>
}

func (tm *TemplateManager) validateRename(oldName, newName string, force bool) error <span class="cov8" title="1">{
        oldPath := filepath.Join(tm.serversDir, oldName+config.FileExtension)
        newPath := filepath.Join(tm.serversDir, newName+config.FileExtension)

        if _, err := os.Stat(oldPath); os.IsNotExist(err) </span><span class="cov8" title="1">{
                return fmt.Errorf("サーバーテンプレート '%s' が見つかりません", oldName)
        }</span>

        <span class="cov8" title="1">if _, err := os.Stat(newPath); err == nil &amp;&amp; !force </span><span class="cov8" title="1">{
                return fmt.Errorf("サーバーテンプレート '%s' は既に存在します\n別の名前を指定するか、--force オプションで上書きしてください", newName)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

func (tm *TemplateManager) performRename(template *ServerTemplate, oldName, newName string) error <span class="cov8" title="1">{
        template.Name = newName

        if err := tm.save(template); err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov8" title="1">oldPath := filepath.Join(tm.serversDir, oldName+config.FileExtension)
        if err := os.Remove(oldPath); err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("古いサーバーテンプレートの削除に失敗しました: %w", err)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

func (tm *TemplateManager) exists(name string) bool <span class="cov8" title="1">{
        templatePath := filepath.Join(tm.serversDir, name+config.FileExtension)
        _, err := os.Stat(templatePath)
        return err == nil
}</span>

func (tm *TemplateManager) save(template *ServerTemplate) error <span class="cov8" title="1">{
        templatePath := filepath.Join(tm.serversDir, template.Name+config.FileExtension)
        return utils.SaveJSON(templatePath, template)
}</span>

// Reset deletes all server templates
func (tm *TemplateManager) Reset(force bool) error <span class="cov8" title="1">{
        if _, err := os.Stat(tm.serversDir); os.IsNotExist(err) </span><span class="cov8" title="1">{
                fmt.Println("サーバーテンプレートディレクトリが存在しません")
                return nil
        }</span>
        
        <span class="cov8" title="1">files, err := os.ReadDir(tm.serversDir)
        if err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("サーバーテンプレートディレクトリの読み込みに失敗しました: %w", err)
        }</span>
        
        <span class="cov8" title="1">templateFiles := []string{}
        for _, file := range files </span><span class="cov8" title="1">{
                if strings.HasSuffix(file.Name(), config.FileExtension) </span><span class="cov8" title="1">{
                        templateFiles = append(templateFiles, file.Name())
                }</span>
        }
        
        <span class="cov8" title="1">if len(templateFiles) == 0 </span><span class="cov8" title="1">{
                fmt.Println("削除するサーバーテンプレートが存在しません")
                return nil
        }</span>
        
        <span class="cov8" title="1">if !force </span><span class="cov0" title="0">{
                fmt.Printf("以下の%d個のサーバーテンプレートを削除します:\n", len(templateFiles))
                for _, file := range templateFiles </span><span class="cov0" title="0">{
                        name := strings.TrimSuffix(file, config.FileExtension)
                        fmt.Printf("  - %s\n", name)
                }</span>
                <span class="cov0" title="0">fmt.Println()
                
                if !interaction.Confirm("すべてのサーバーテンプレートを削除しますか？") </span><span class="cov0" title="0">{
                        fmt.Println("リセットをキャンセルしました")
                        return nil
                }</span>
        }
        
        <span class="cov8" title="1">deletedCount := 0
        for _, file := range templateFiles </span><span class="cov8" title="1">{
                templatePath := filepath.Join(tm.serversDir, file)
                if err := os.Remove(templatePath); err != nil </span><span class="cov0" title="0">{
                        fmt.Printf("警告: %s の削除に失敗しました: %v\n", file, err)
                }</span> else<span class="cov8" title="1"> {
                        deletedCount++
                }</span>
        }
        
        <span class="cov8" title="1">fmt.Printf("サーバーテンプレートを%d個削除しました\n", deletedCount)
        return nil</span>
}</pre>
		
		<pre class="file" id="file26" style="display: none">package server

import (
        "fmt"

        "github.com/naoto24kawa/mcpconfig/internal/interaction"
)

// TemplateUpdater handles template update operations
type TemplateUpdater struct {
        templateManager *TemplateManager
}

// NewTemplateUpdater creates a new TemplateUpdater instance
func NewTemplateUpdater(templateManager *TemplateManager) *TemplateUpdater <span class="cov8" title="1">{
        return &amp;TemplateUpdater{
                templateManager: templateManager,
        }
}</span>

// SaveManual saves or updates a server template manually
func (tu *TemplateUpdater) SaveManual(templateName, command string, args []string, env map[string]string, force bool) error <span class="cov8" title="1">{
        existing := tu.templateExists(templateName)

        if existing &amp;&amp; !force </span><span class="cov0" title="0">{
                if !interaction.ConfirmOverwrite("サーバーテンプレート", templateName) </span><span class="cov0" title="0">{
                        return fmt.Errorf("上書きをキャンセルしました")
                }</span>
        }

        <span class="cov8" title="1">var template *ServerTemplate
        var err error

        if existing </span><span class="cov8" title="1">{
                template, err = tu.updateExistingTemplate(templateName, command, args, env)
                if err != nil </span><span class="cov0" title="0">{
                        return err
                }</span>
                <span class="cov8" title="1">fmt.Printf("サーバーテンプレート '%s' を更新しました\n", templateName)</span>
        } else<span class="cov8" title="1"> {
                template, err = tu.createNewTemplate(templateName, command, args, env)
                if err != nil </span><span class="cov8" title="1">{
                        return err
                }</span>
                <span class="cov8" title="1">fmt.Printf("サーバーテンプレート '%s' を作成しました\n", templateName)</span>
        }

        <span class="cov8" title="1">return tu.templateManager.save(template)</span>
}

func (tu *TemplateUpdater) updateExistingTemplate(templateName, command string, args []string, env map[string]string) (*ServerTemplate, error) <span class="cov8" title="1">{
        template, err := tu.templateManager.Load(templateName)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">if command != "" </span><span class="cov8" title="1">{
                template.ServerConfig.Command = command
        }</span>

        <span class="cov8" title="1">tu.UpdateTemplateArgs(template, args)
        tu.UpdateTemplateEnv(template, env)

        return template, nil</span>
}

func (tu *TemplateUpdater) createNewTemplate(templateName, command string, args []string, env map[string]string) (*ServerTemplate, error) <span class="cov8" title="1">{
        if command == "" </span><span class="cov8" title="1">{
                return nil, fmt.Errorf("コマンドが指定されていません")
        }</span>

        <span class="cov8" title="1">return CreateServerTemplate(templateName, command, args, env), nil</span>
}

func (tu *TemplateUpdater) UpdateTemplateArgs(template *ServerTemplate, args []string) <span class="cov8" title="1">{
        if args == nil </span><span class="cov8" title="1">{
                return
        }</span>

        <span class="cov8" title="1">if len(args) == 1 &amp;&amp; args[0] == "" </span><span class="cov8" title="1">{
                template.ServerConfig.Args = nil
        }</span> else<span class="cov8" title="1"> {
                template.ServerConfig.Args = args
        }</span>
}

func (tu *TemplateUpdater) UpdateTemplateEnv(template *ServerTemplate, env map[string]string) <span class="cov8" title="1">{
        if env == nil </span><span class="cov8" title="1">{
                return
        }</span>

        <span class="cov8" title="1">if len(env) == 0 </span><span class="cov8" title="1">{
                template.ServerConfig.Env = nil
                return
        }</span>

        <span class="cov8" title="1">if template.ServerConfig.Env == nil </span><span class="cov8" title="1">{
                template.ServerConfig.Env = make(map[string]string)
        }</span>

        <span class="cov8" title="1">for k, v := range env </span><span class="cov8" title="1">{
                if v == "" </span><span class="cov8" title="1">{
                        delete(template.ServerConfig.Env, k)
                }</span> else<span class="cov8" title="1"> {
                        template.ServerConfig.Env[k] = v
                }</span>
        }
}

func (tu *TemplateUpdater) templateExists(name string) bool <span class="cov8" title="1">{
        exists, _ := tu.templateManager.Exists(name)
        return exists
}</pre>
		
		<pre class="file" id="file27" style="display: none">package utils

import (
        "fmt"
        "os"
)

const (
        ExitSuccess        = 0
        ExitGeneralError   = 1
        ExitResourceError  = 2
        ExitFileError      = 3
        ExitFormatError    = 4
        ExitEnvironment    = 5
        ExitServerError    = 6
        ExitArgumentError  = 7
        ExitReferenceError = 8
)

// HandleError handles errors with standardized error reporting and exit codes
func HandleError(err error, exitCode int) <span class="cov0" title="0">{
        if err != nil </span><span class="cov0" title="0">{
                fmt.Fprintln(os.Stderr, "エラー:", err)
                os.Exit(exitCode)
        }</span>
}

// HandleArgumentError handles argument validation errors
func HandleArgumentError(err error) <span class="cov0" title="0">{
        HandleError(err, ExitArgumentError)
}</span>

// HandleGeneralError handles general errors
func HandleGeneralError(err error) <span class="cov0" title="0">{
        HandleError(err, ExitGeneralError)
}</span>

// HandleEnvironmentError handles environment setup errors
func HandleEnvironmentError(err error) <span class="cov0" title="0">{
        HandleError(err, ExitEnvironment)
}</span>

// ParseProfileName extracts profile name from args, using default if not provided
func ParseProfileName(args []string, defaultName string) (profileName string, argsOffset int) <span class="cov0" title="0">{
        if len(args) &lt; 1 </span><span class="cov0" title="0">{
                fmt.Printf("プロファイル名が指定されていないため、デフォルト '%s' を使用します\n", defaultName)
                return defaultName, 0
        }</span>
        <span class="cov0" title="0">return args[0], 1</span>
}

// ParseFlag parses a flag value from args at the given index
func ParseFlag(args []string, index int, flag string) (string, int, error) <span class="cov0" title="0">{
        if index+1 &gt;= len(args) </span><span class="cov0" title="0">{
                return "", index, fmt.Errorf("%s オプションに値が指定されていません", flag)
        }</span>
        <span class="cov0" title="0">return args[index+1], index + 1, nil</span>
}

// ParseRenameArgs parses rename command arguments (special case)
func ParseRenameArgs(args []string, defaultName string) (oldName, newName string, argsOffset int, err error) <span class="cov0" title="0">{
        if len(args) &lt; 1 </span><span class="cov0" title="0">{
                return "", "", 0, fmt.Errorf("新しいプロファイル名が指定されていません\n使用方法: mcpconfig rename [現在の名前] &lt;新しい名前&gt;")
        }</span>
        
        <span class="cov0" title="0">if len(args) &lt; 2 </span><span class="cov0" title="0">{
                oldName = defaultName
                newName = args[0]
                fmt.Printf("元のプロファイル名が指定されていないため、デフォルト '%s' を使用します\n", oldName)
                return oldName, newName, 1, nil
        }</span>
        
        <span class="cov0" title="0">return args[0], args[1], 2, nil</span>
}</pre>
		
		<pre class="file" id="file28" style="display: none">package utils

import (
        "bufio"
        "encoding/json"
        "fmt"
        "os"
        "strings"
)

func FileExists(path string) bool <span class="cov8" title="1">{
        _, err := os.Stat(path)
        return err == nil
}</span>

func LoadJSON(path string, v interface{}) error <span class="cov8" title="1">{
        file, err := os.Open(path)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">defer file.Close()
        
        decoder := json.NewDecoder(file)
        return decoder.Decode(v)</span>
}

func SaveJSON(path string, v interface{}) error <span class="cov8" title="1">{
        file, err := os.Create(path)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        <span class="cov8" title="1">defer file.Close()
        
        encoder := json.NewEncoder(file)
        encoder.SetIndent("", "  ")
        return encoder.Encode(v)</span>
}


func LoadEnvFile(path string) (map[string]string, error) <span class="cov8" title="1">{
        file, err := os.Open(path)
        if err != nil </span><span class="cov8" title="1">{
                return nil, fmt.Errorf("環境変数ファイルが見つかりません: '%s'", path)
        }</span>
        <span class="cov8" title="1">defer file.Close()
        
        envMap := make(map[string]string)
        scanner := bufio.NewScanner(file)
        lineNum := 0
        
        for scanner.Scan() </span><span class="cov8" title="1">{
                lineNum++
                line := strings.TrimSpace(scanner.Text())
                
                if line == "" || strings.HasPrefix(line, "#") </span><span class="cov8" title="1">{
                        continue</span>
                }
                
                <span class="cov8" title="1">parts := strings.SplitN(line, "=", 2)
                if len(parts) != 2 </span><span class="cov8" title="1">{
                        return nil, fmt.Errorf("環境変数ファイルの形式が不正です: '%s' 行%d", path, lineNum)
                }</span>
                
                <span class="cov8" title="1">key := strings.TrimSpace(parts[0])
                value := strings.TrimSpace(parts[1])
                
                value = strings.Trim(value, `"'`)
                
                envMap[key] = value</span>
        }
        
        <span class="cov8" title="1">if err := scanner.Err(); err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("環境変数ファイルの読み込みに失敗しました: '%s'", path)
        }</span>
        
        <span class="cov8" title="1">return envMap, nil</span>
}</pre>
		
		<pre class="file" id="file29" style="display: none">package utils

import (
        "fmt"
        "regexp"
        "strings"
)

var (
        namePattern    = regexp.MustCompile(`^[a-zA-Z0-9_-]+$`)
        reservedWords  = []string{"help", "version", "list", "server", "apply", "save", "create", "delete", "rename", "add", "remove", "show"}
        envKeyPattern  = regexp.MustCompile(`^[a-zA-Z][a-zA-Z0-9_]*$`)
)

const MaxNameLength = 50

func ValidateName(name string, resourceType string) error <span class="cov8" title="1">{
        if name == "" </span><span class="cov8" title="1">{
                return fmt.Errorf("%s名が指定されていません", resourceType)
        }</span>
        
        <span class="cov8" title="1">if len(name) &gt; MaxNameLength </span><span class="cov8" title="1">{
                return fmt.Errorf("%s名は%d文字以内で指定してください", resourceType, MaxNameLength)
        }</span>
        
        <span class="cov8" title="1">if !namePattern.MatchString(name) </span><span class="cov8" title="1">{
                return fmt.Errorf("%s名に使用できない文字が含まれています（使用可能: 英数字、ハイフン、アンダースコア）", resourceType)
        }</span>
        
        <span class="cov8" title="1">for _, reserved := range reservedWords </span><span class="cov8" title="1">{
                if name == reserved </span><span class="cov8" title="1">{
                        return fmt.Errorf("%s名に予約語 '%s' は使用できません", resourceType, reserved)
                }</span>
        }
        
        <span class="cov8" title="1">return nil</span>
}

func ParseEnvVars(envStr string) (map[string]string, error) <span class="cov8" title="1">{
        if envStr == "" </span><span class="cov8" title="1">{
                return nil, nil
        }</span>
        
        <span class="cov8" title="1">envMap := make(map[string]string)
        pairs := strings.Split(envStr, ",")
        
        for _, pair := range pairs </span><span class="cov8" title="1">{
                parts := strings.SplitN(pair, "=", 2)
                if len(parts) != 2 </span><span class="cov8" title="1">{
                        return nil, fmt.Errorf("環境変数の形式が不正です: '%s'", pair)
                }</span>
                
                <span class="cov8" title="1">key := strings.TrimSpace(parts[0])
                value := strings.TrimSpace(parts[1])
                
                if !envKeyPattern.MatchString(key) </span><span class="cov8" title="1">{
                        return nil, fmt.Errorf("環境変数名が不正です: '%s'", key)
                }</span>
                
                <span class="cov8" title="1">envMap[key] = value</span>
        }
        
        <span class="cov8" title="1">return envMap, nil</span>
}

func ParseArgs(argsStr string) []string <span class="cov8" title="1">{
        if argsStr == "" </span><span class="cov8" title="1">{
                return nil
        }</span>
        
        <span class="cov8" title="1">args := strings.Split(argsStr, ",")
        result := make([]string, 0, len(args))
        
        for _, arg := range args </span><span class="cov8" title="1">{
                trimmed := strings.TrimSpace(arg)
                if trimmed != "" </span><span class="cov8" title="1">{
                        result = append(result, trimmed)
                }</span>
        }
        
        <span class="cov8" title="1">return result</span>
}</pre>
		
		<pre class="file" id="file30" style="display: none">package main

import (
        "github.com/naoto24kawa/mcpconfig/cmd"
)

func main() <span class="cov0" title="0">{
        cmd.Execute()
}</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
